
Runner.buttonEvents["New_Button7"]=function(pageObj,proxy,pageid){pageObj.buttonNames[pageObj.buttonNames.length]='New_Button7';if(!pageObj.buttonEventBefore['New_Button7']){pageObj.buttonEventBefore['New_Button7']=function(params,ctrl,pageObj,proxy,pageid,rowData,row,submit){var ajax=ctrl;}}
if(!pageObj.buttonEventAfter['New_Button7']){pageObj.buttonEventAfter['New_Button7']=function(result,ctrl,pageObj,proxy,pageid,rowData,row,params){var ajax=ctrl;params["ProcesoId"]=result["ProcesoId"];var popup=Runner.displayPopup({html:"<input type='file' name='archivo[]' id='archivo' accept='.pdf' multiple /><input type='submit' id='subir' value='Subir'></input><br/><div id='lista-archivos'></div><div id='estado'></div>",header:'Subir Archivos',width:600,height:600});function actualizarListadoArchivos(){$.ajax({url:"classes/listar_archivos.php?w2="+params["ProcesoId"],method:"GET",dataType:"html",success:function(response){$("#lista-archivos").html(response);},error:function(error){console.error("Error en la solicitud AJAX",error);}});}
$(document).ready(function(){$("#subir").on("click",function(e){e.preventDefault();var archivos=$('#archivo')[0].files;var valorPOST=params['ProcesoId'];if(archivos.length===0){$('#estado').html('Por favor, selecciona al menos un archivo.');return;}
var formData=new FormData();for(var i=0;i<archivos.length;i++){formData.append('archivos[]',archivos[i]);}
formData.append('variablePOST',valorPOST);$.ajax({url:'classes/upload_files.php',type:'POST',data:formData,contentType:false,processData:false,success:function(response){$('#estado').html(response);actualizarListadoArchivos();},error:function(xhr,status,error){$('#estado').html('Error: '+error);}});});$.ajax({url:"classes/listar_archivos.php?w2="+result["ProcesoId"],method:"GET",dataType:"html",success:function(response){$("#lista-archivos").html(response);},error:function(error){console.error("Error en la solicitud AJAX",error);}});});}}
$('a[id="New_Button7"]').each(function(){if($(this).closest('.gridRowAdd').length){return;}
this.id="New_Button7"+"_"+Runner.genId();var button_New_Button7=new Runner.form.Button({id:this.id,btnName:"New_Button7"});button_New_Button7.init({args:[pageObj,proxy,pageid]});});};